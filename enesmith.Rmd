---
title: "enesmith"
author: "Elisabeth Nesmith"
date: "4/8/2021"
output: html_document
---

```{r setup}
library(tidyverse)
library(here)
library(plotly)
```

```{r load data}
social_media <- read_csv("~/Downloads/SDS 235/DC5-Data/Y*Int Social Media Data/YInt.csv") 
static_sensor_locations <- read_csv("~/Downloads/SDS 235/DC5-Data/Sensor Data and Maps/StaticSensorLocations.csv") 
static_sensor_readings <- read_csv("~/Downloads/SDS 235/DC5-Data/Sensor Data and Maps/StaticSensorReadings.csv") 
mobile_sensor_readings <- read_csv("~/Downloads/SDS 235/DC5-Data/Sensor Data and Maps/MobileSensorReadings.csv") 
mc1_reports_data <- read_csv("~/Downloads/SDS 235/DC5-Data/Damage Reports/mc1-reports-data.csv") 
```

Questions to answer:

Compare the reliability of neighborhood reports. Which neighborhoods are providing reliable reports? Provide a rationale for your response.

Compare radiation measurements over time from both static and mobile sensors to identify areas where elevated radiation is detected. How does this change over time? How should the risk of radiation damage be mitigated?

Looking at:

MC1 reports
static sensor readings
mobile sensor readings

```{r}
#looking at MC1 reports
#grouping by location
#calculating average of each variable (average across 4/6-4/11)

mc1_averages <- aggregate(mc1_reports_data[, 2:7], list(mc1_reports_data$location), mean, na.rm = TRUE)
```

```{r}
#visualize the averages for each category across locations

#sewer and water plot
fig <- plot_ly(
  x = mc1_averages$Group.1,
  y = mc1_averages$sewer_and_water,
  name = "Citizen-Reported Sewer and Water Damage by Neighborhood",
  type = "bar"
)

fig
```

Location 7 had the highest average of reported damage to sewer and water at 8.5, followed by locations 8, 9, and 3 with averages of 7.49, 7.45, and 7.27 respectively.


```{r}
#scaling map to coordinates and plotting locations of static sensors
fig1 <- static_sensor_locations %>%
  plot_ly(
    x = ~Long,
    y = ~Lat,
    type = "scatter",
    mode = "markers",
    text = ~`Sensor-id`
  ) %>%
  layout(
    title = "Locations of Static Sensors",
    images = list(
      source = "https://raw.githubusercontent.com/mariumtapal/sds235-dc5/master/StHimarkLabeledMap.png",
      xref = "x",
      yref = "y",
      x = -120,
      y = 0.2385,
      sizex = 0.2883,
      sizey = 0.2385,
      sizing = "stretch",
      opacity = 1,
      layer = "below"
    )
  )

fig1
```

```{r}
#wrangling static sensor readings to get averages for each sensor across the six days (4/6 - 4/11) and creating new variable to correspond to location in mc1 reports, then joining by location

static_averages <- static_sensor_readings %>% 
  mutate(Group.1 = if_else(`Sensor-id` == 1, 1, 
                           if_else(`Sensor-id` == 4, 6,
                                   if_else(`Sensor-id` == 6, 5,
                                           if_else(`Sensor-id` == 9, 3,
                                                   if_else(`Sensor-id` == 11, 9,
                                                           if_else(`Sensor-id` == 14, 13, 4))))))) %>%
  group_by(Group.1) %>% 
  summarize(average = mean(Value)) %>% 
  right_join(mc1_averages, by = 'Group.1')
```

```{r}
#visualize averages of static sensor data by location
fig2 <- plot_ly(
  x = static_averages$Group.1,
  y = static_averages$average,
  name = "Average Radiation Levels of Static Sensors by Neighborhood",
  type = "bar"
)

fig2
```

The neighborhood with the highest average radiation over the course of the six days, according to the static sensor data, is neighborhood 3 at 17.103 cpm, followed by neighborhood 4 at 16.245 cpm and neighborhood 9 at 15.835 cpm. However, because the static sensors are only located in neighborhoods 1, 3, 4, 5, 6, 9, and 13, this doesn't give us a full picture of the radiation at every neighborhood. It does make sense that neighborhoods 3 and 4 were most affected though, as they have pretty close proximity to the nuclear power plant.

```{r}
#not helpful/incorrect graph
#side by side bar plot of static sensor averages and mc1 averages (shake intensity)
fig3 <- plot_ly(static_averages, x = ~Group.1, y = ~shake_intensity, type = 'bar', name = 'Shake Intensity')
fig3 <- fig3 %>% add_trace(y = ~average, name = 'Average Radiation from Sensors (cpm)')
fig3 <- fig3 %>% add_trace(y = ~(average-shake_intensity), name = 'Difference Between Shake Intensity and Average')
fig3 <- fig3 %>% layout(yaxis = list(title = 'Average Radiation and Shake Intensity'), barmode = 'group')

fig3
```

```{r}
#create map of static sensor 
#load packages and shapefile

library(leaflet)
library(raster)

system("unzip StHimarkNeighborhoodShapefiles.zip")
```

```{r}
# Read this shape file with the rgdal library. 
shape <- readOGR(dsn = "StHimarkNeighborhoodShapefiles", layer = "StHimark")
```



```{r}
map <- ggplot() + 
  geom_polygon(data = shape, aes(x = long, y = lat), colour = "black", fill = NA)

ggplotly(p = map)
```





